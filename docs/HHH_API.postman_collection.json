{
  "info": {
    "name": "HHH Project – Full API Collection",
    "description": "Comprehensive Postman collection for all REST and GraphQL endpoints in the HHH project. Environment variable {{base_url}} is used for portability. Includes CSRF-secure flows, cookie usage, and request/response samples.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000",
      "type": "default"
    },
    {
      "key": "csrf_token",
      "value": "",
      "type": "default",
      "description": "Value of hhh_csrf cookie. Obtain via /api/v1/auth/health, then extract cookie value."
    }
  ],
  "item": [
    {
      "name": "Auth – Health",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/v1/auth/health",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "auth", "health"]
        },
        "description": "Returns API liveness and sets CSRF cookie."
      }
    },
    {
      "name": "Auth – Register",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "name": "Content-Type", "value": "application/json" },
          {
            "key": "X-CSRF-Token",
            "name": "X-CSRF-Token",
            "value": "{{csrf_token}}",
            "description": "Required: Value of hhh_csrf cookie; must be obtained by first visiting /health."
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"password123\",\n  \"name\": \"John Doe\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/auth/register",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "auth", "register"]
        },
        "description": "Registers a new user. Requires CSRF token in header, which must match hhh_csrf cookie."
      }
    },
    {
      "name": "Auth – Login",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "name": "Content-Type", "value": "application/json" },
          {
            "key": "X-CSRF-Token",
            "name": "X-CSRF-Token",
            "value": "{{csrf_token}}",
            "description": "Required: Value of hhh_csrf cookie, which must be fetched via /health."
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"user@example.com\",\n  \"password\": \"password123\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/auth/login",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "auth", "login"]
        },
        "description": "Logs in a user. Requires CSRF token."
      }
    },
    {
      "name": "Auth – Refresh",
      "request": {
        "method": "POST",
        "header": [
          { "key": "X-CSRF-Token", "name": "X-CSRF-Token", "value": "{{csrf_token}}" }
        ],
        "url": {
          "raw": "{{base_url}}/api/v1/auth/refresh",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "auth", "refresh"]
        },
        "description": "Refreshes access/refresh cookies using the refresh cookie; requires CSRF."
      }
    },
    {
      "name": "Auth – Logout",
      "request": {
        "method": "POST",
        "header": [
          { "key": "X-CSRF-Token", "name": "X-CSRF-Token", "value": "{{csrf_token}}" }
        ],
        "url": {
          "raw": "{{base_url}}/api/v1/auth/logout",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "auth", "logout"]
        },
        "description": "Logs out the user, clears cookies. Requires CSRF."
      }
    },
    {
      "name": "GraphQL – Health Query (GET)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/graphql?query={health}",
          "host": ["{{base_url}}"],
          "path": ["graphql"],
          "query": [
            { "key": "query", "value": "{health}" }
          ]
        },
        "description": "GraphQL health check. No CSRF required."
      }
    },
    {
      "name": "GraphQL – Generic Query (GET)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/graphql?query={{gql_query}}&variables={{gql_variables}}",
          "host": ["{{base_url}}"],
          "path": ["graphql"],
          "query": [
            { "key": "query", "value": "{{gql_query}}" },
            { "key": "variables", "value": "{{gql_variables}}" }
          ]
        },
        "description": "Send any GraphQL query (GET). Fill variables as needed."
      }
    },
    {
      "name": "GraphQL – Mutation (POST)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "name": "Content-Type", "value": "application/json" },
          { "key": "X-CSRF-Token", "name": "X-CSRF-Token", "value": "{{csrf_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"mutation ($input: CreateEntryInput!) { createEntry(input: $input) { id content section_type } }\",\n  \"variables\": {\n    \"input\": {\n      \"user_id\": \"USER_ID\",\n      \"group_id\": \"GROUP_ID\",\n      \"section_type\": \"Health\",\n      \"content\": \"Walked 5k steps\"\n    }\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/graphql",
          "host": ["{{base_url}}"],
          "path": ["graphql"]
        },
        "description": "Perform GraphQL mutations. CSRF token required."
      }
    },
    {
      "name": "Backups – Trigger (POST, Super Admin only)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "name": "Content-Type", "value": "application/json" },
          {
            "key": "X-CSRF-Token",
            "name": "X-CSRF-Token",
            "value": "{{csrf_token}}",
            "description": "Required: value of hhh_csrf cookie"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/v1/backups/trigger",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "backups", "trigger"]
        },
        "description": "Triggers a database backup. Requires Super Admin role and CSRF header."
      }
    },
    {
      "name": "Backups – Logs (GET, Super Admin only)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/v1/backups/logs?limit=50&offset=0",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "backups", "logs"],
          "query": [
            { "key": "limit", "value": "50" },
            { "key": "offset", "value": "0" }
          ]
        },
        "description": "Returns recent backup logs. Requires Super Admin role."
      }
    },
    {
      "name": "Backups – Stats (GET, Super Admin only)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/v1/backups/stats",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "backups", "stats"]
        },
        "description": "Returns backup statistics. Requires Super Admin role."
      }
    },
    {
      "name": "Analytics – Group Analytics (GET, Member/Admin only)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/v1/analytics/group/GROUP_ID?start_date=2025-01-01&end_date=2025-01-31",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "analytics", "group", "GROUP_ID"],
          "query": [
            { "key": "start_date", "value": "2025-01-01", "description": "Optional start date (YYYY-MM-DD)" },
            { "key": "end_date", "value": "2025-01-31", "description": "Optional end date (YYYY-MM-DD)" }
          ]
        },
        "description": "Returns analytics for a specific group. Requires group membership or admin role."
      }
    },
    {
      "name": "Analytics – Global Analytics (GET, Super Admin only)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/v1/analytics/global?start_date=2025-01-01&end_date=2025-01-31",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "analytics", "global"],
          "query": [
            { "key": "start_date", "value": "2025-01-01", "description": "Optional start date (YYYY-MM-DD)" },
            { "key": "end_date", "value": "2025-01-31", "description": "Optional end date (YYYY-MM-DD)" }
          ]
        },
        "description": "Returns global system analytics. Requires Super Admin role."
      }
    },
    {
      "name": "Roles – Promote to Group Admin (POST, Group Admin only)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "name": "Content-Type", "value": "application/json" },
          { "key": "X-CSRF-Token", "name": "X-CSRF-Token", "value": "{{csrf_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"userId\": \"USER_ID\",\n  \"groupId\": \"GROUP_ID\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/roles/promote",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "roles", "promote"]
        },
        "description": "Promotes a user to group admin. Requires group admin permissions and CSRF token."
      }
    },
    {
      "name": "Roles – Demote from Group Admin (POST, Group Admin only)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "name": "Content-Type", "value": "application/json" },
          { "key": "X-CSRF-Token", "name": "X-CSRF-Token", "value": "{{csrf_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"userId\": \"USER_ID\",\n  \"groupId\": \"GROUP_ID\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/v1/roles/demote",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "roles", "demote"]
        },
        "description": "Demotes a user from group admin to regular member. Requires group admin permissions and CSRF token."
      }
    },
    {
      "name": "Audit Logs – Get Logs (GET, Super Admin only)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/v1/audit/logs?limit=50&offset=0&userId=USER_ID&action=login",
          "host": ["{{base_url}}"],
          "path": ["api", "v1", "audit", "logs"],
          "query": [
            { "key": "limit", "value": "50", "description": "Number of logs to return (max 100)" },
            { "key": "offset", "value": "0", "description": "Pagination offset" },
            { "key": "userId", "value": "USER_ID", "description": "Optional: Filter by user ID" },
            { "key": "action", "value": "login", "description": "Optional: Filter by action type" },
            { "key": "resourceType", "value": "auth", "description": "Optional: Filter by resource type" }
          ]
        },
        "description": "Returns paginated audit logs with optional filtering. Requires Super Admin role."
      }
    },
    {
      "name": "GDPR – Export My Data (GraphQL Mutation)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "name": "Content-Type", "value": "application/json" },
          { "key": "X-CSRF-Token", "name": "X-CSRF-Token", "value": "{{csrf_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"mutation { exportMyData { success data message } }\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/graphql",
          "host": ["{{base_url}}"],
          "path": ["graphql"]
        },
        "description": "Exports user's complete data for GDPR compliance. Requires authentication and CSRF token."
      }
    },
    {
      "name": "GDPR – Delete My Account (GraphQL Mutation)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "name": "Content-Type", "value": "application/json" },
          { "key": "X-CSRF-Token", "name": "X-CSRF-Token", "value": "{{csrf_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"mutation { deleteMyAccount(confirm: true) { success message } }\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/graphql",
          "host": ["{{base_url}}"],
          "path": ["graphql"]
        },
        "description": "Soft deletes user's account with PII anonymization per GDPR. Requires explicit confirmation and CSRF token."
      }
    }
  ]
}
